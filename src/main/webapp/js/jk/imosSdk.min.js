!function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}({8:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"ImosSdk",function(){return s});var o=n(9),r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(){i(this,e),this.ip="",this.token="",this.paneNum=9,this.htmlUrl="",this.iframes=[],this.callback="",this.xpCode="",this.xpFirstWndCode=1100,this.sipStep=-1,this.keepAlive=void 0,this.sip=void 0,this.iframeBack=void 0,this.recordList=[],this.isTasking=!1,this.recordTaskObj={}}return a(e,[{key:"init",value:function(e,t,n,i,o){var r=this;return void 0===n&&(n=9),void 0===i&&(i="/imosSdk.html"),void 0===o&&(o=!0),new Promise(function(a,s){return e?t?""!==r.ip?(console.warn("\u91cd\u590d\u521d\u59cb\u5316"),void s("\u91cd\u590d\u521d\u59cb\u5316")):(r.ip=e,r.token=t,r.paneNum=n,r.htmlUrl=i,r._keepAliveFunc(o),window.document.body.addEventListener("DOMNodeRemoved",r._onIframeClosed),r._createImosCB(a,s),r._createCBIframe(),void setTimeout(function(){-1===r.sipStep&&(r.sipStep=99,a&&(s("\u767b\u5f55\u8d85\u65f6"),s=void 0,a=void 0))},6e4)):(console.warn("\u8bf7\u4f20\u5165token"),void s("\u8bf7\u4f20\u5165token")):(console.warn("\u8bf7\u4f20\u5165ip"),void s("\u8bf7\u4f20\u5165ip"))})}},{key:"_keepAliveFunc",value:function(e){var t=this;if(e){this.keepAlive=new WebSocket("ws://"+this.ip+":8088/VIID/event");var n=0,i=function(){},o=function(){n=0,t.keepAlive.send(t.token)};i=function(e){if(console.error(e),n>15)return void console.error("\u8d85\u51fa\u91cd\u8bd5\u6b21\u6570");setTimeout(function(){n++,t.keepAlive=new WebSocket("ws://"+t.ip+":8088/VIID/event"),t.keepAlive.onopen=o,t.keepAlive.onclose=i,t.keepAlive.onerror=i},1e3)},this.keepAlive.onopen=o,this.keepAlive.onclose=i,this.keepAlive.onerror=i}}},{key:"_createImosCB",value:function(e,t){var n=this;window._imosCallback=function(i){var o=i.params;if(i.func)switch(i.func){case"init":if(-1!==n.sipStep)return;var r=o[0];n.xpFirstWndCode=parseInt(r.XpFirstWndCode.split("&")[1],10),n.xpCode=r.XpCode,n._linkSip(r.XpCode);break;case"config":e(),t=void 0,e=void 0;break;case"error":t(o[0]),t=void 0,e=void 0;break;case"imosCallBack":for(var a=0;a<n.iframes.length;a++)if(n.iframes[a].xpcode===o.xpCode){var s=n.iframes[a];return"imosSdkPlayRecord"!==o.func&&"imosSdkRecordJump"!==o.func||(n.isTasking=!1,s.hasRecordTask=!1,delete n.recordTaskObj[s.id],n.keepWorking()),void(s.imosCallBack[o.tag]&&(s.imosCallBack[o.tag](o.func,o.errCode,o.errMessage,o.el),delete s.imosCallBack[o.tag]))}break;default:console.warn("\u672a\u5b9a\u4e49\u7684\u65b9\u6cd5"+i.func)}}}},{key:"_createCBIframe",value:function(){var e=this;this.iframeBack={};try{this.iframeBack=document.createElement("<iframe></iframe>")}catch(e){this.iframeBack=document.createElement("iframe")}this.iframeBack.id=o.a.GUID(),this.iframeBack.name="imosCallbackPage",this.iframeBack.src="http://"+this.ip+":7010/static/imosCallBack.html",this.iframeBack.width="0px",this.iframeBack.height="0px",this.iframeBack.frameborder="0",this.iframeBack.style.display="none",this.iframeBack.onload=function(){e.iframeBack.contentWindow.postMessage({func:"init",params:{token:e.token,url:"http://"+window.location.host+e.htmlUrl}},"*")},document.body.appendChild(this.iframeBack)}},{key:"_linkSip",value:function(e){var t=this,n=null;this.sip=new WebSocket("ws://"+this.ip+":5082/ccRegister"),window.addEventListener("unload",function(){99!==t.sipStep&&(t.sipStep=99,t.sip.send(JSON.stringify({XPCode:t.xpCode,Step:2})))});var i=function(){-1===t.sipStep?(t.sipStep=0,t.sip.send(JSON.stringify({XPCode:e,Step:0}))):(t.sipStep=1,t.sip.send(JSON.stringify({XPCode:e,Step:1})))},o=function(e){var n=JSON.parse(e.data);if(n)switch(n.Step){case 0:t.sipStep=1,t.iframeBack.contentWindow.postMessage({func:"config",params:{}},"*");break;case 1:break;case 2:t.sipStep=99;break;case 3:for(var i=0;i<t.iframes.length;i++)t.iframes[i].xpcode===n.XPCode&&t.iframes[i].contentWindow.postMessage({func:"linkMS",params:{ip:n.IP,port:n.Port,session:n.Session}},"*");break;case 4:for(var o=0;o<t.iframes.length;o++)t.iframes[o].xpcode===n.XPCode&&t.iframes[o].contentWindow.postMessage({func:"unLinkMS",params:{}},"*");break;default:console.log(n.Step)}},r=function(){1===t.sip.readyState&&t.sip.send(JSON.stringify({XPCode:e,Step:1}))},a=function(){if(null!=n&&clearInterval(n),t.sipStep>5&&t.sipStep<1)return void(99!==t.sipStep&&console.error("imos \u4fdd\u6d3b\u5931\u8d25\uff1a"+t.sipStep));t.sipStep++,setTimeout(function(){t.sip=new WebSocket(t.sip.url),t.sip.onopen=i,t.sip.onmessage=o,t.sip.onclose=t,t.sip.onerror=t,n=setInterval(r,3e4)},1e3)};this.sip.onopen=i,this.sip.onmessage=o,this.sip.onclose=a,this.sip.onerror=a,n=setInterval(r,3e4)}},{key:"playLive",value:function(e,t,n,i){for(var a=this,s=0;s<this.iframes.length;s++)if(this.iframes[s]===e||this.iframes[s].id===e){var c=function(){var e=a.iframes[s],r=o.a.GUID();return a._cancelRecordTask(e),"function"===typeof i&&(e.imosCallBack[r]=i),e.readyState?e.contentWindow.postMessage({func:"imosSdkPlayLive",params:{token:a.token,xpcode:e.xpcode,cameraCode:t,titleName:n,tag:r}},"*"):e.onload=function(){e.readyState=!0,e.contentWindow.postMessage({func:"imosSdkPlayLive",params:{token:a.token,xpcode:e.xpcode,cameraCode:t,titleName:n,tag:r}},"*")},{v:void 0}}();if("object"===("undefined"===typeof c?"undefined":r(c)))return c.v}}},{key:"imosSdkPlayLive",value:function(e,t,n,i){this.playLive(e,t,n,i)}},{key:"playRecord",value:function(e,t,n,i,a,s){for(var c=this,u=0;u<this.iframes.length;u++)if(this.iframes[u]===e||this.iframes[u].id===e){var l=function(){var r=c.iframes[u],l=o.a.GUID();"function"===typeof s&&(r.imosCallBack[l]=s);var f=function(){r.contentWindow.postMessage({func:"imosSdkPlayRecord",params:{token:c.token,xpcode:r.xpcode,cameraCode:t,titleName:n,tag:l,startTime:i,endTime:a}},"*")};return r.readyState?(c._cancelRecordTask(r),c.recordList.push(e),c.recordTaskObj[e]=f,c.keepWorking()):r.onload=function(){r.readyState=!0,c._cancelRecordTask(r),c.recordList.push(e),c.recordTaskObj[e]=f,c.keepWorking()},{v:void 0}}();if("object"===("undefined"===typeof l?"undefined":r(l)))return l.v}}},{key:"imosSdkPlayRecord",value:function(e,t,n,i,o,r){this.playRecord(e,t,n,i,o,r)}},{key:"keepWorking",value:function(){if(!this.isTasking){this.isTasking=!0;var e=this.recordList.shift();this.recordTaskObj[e]()}}},{key:"recordJump",value:function(e,t,n){for(var i=this,a=0;a<this.iframes.length;a++)if(this.iframes[a]===e||this.iframes[a].id===e){var s=function(){var r=i.iframes[a],s=o.a.GUID();"function"===typeof n&&(r.imosCallBack[s]=n);var c=function(){r.contentWindow.postMessage({func:"imosSdkRecordJump",params:{token:i.token,xpcode:r.xpcode,jumpTime:t,tag:s}},"*")};return r.readyState?(i._cancelRecordTask(r),i.recordList.push(e),i.recordTaskObj[e]=c,i.keepWorking()):n({ErrCode:55006,ErrMsg:"\u5f53\u524d\u7a97\u683c\u672a\u542f\u7528\u56de\u653e\u4e1a\u52a1"}),{v:void 0}}();if("object"===("undefined"===typeof s?"undefined":r(s)))return s.v}}},{key:"imosSdkRecordJump",value:function(e,t,n){this.recordJump(e,t,n)}},{key:"sdkStop",value:function(e,t){for(var n=this,i=0;i<this.iframes.length;i++)if(this.iframes[i]===e||this.iframes[i].id===e){var a=function(){var e=n.iframes[i],r=o.a.GUID();return"function"===typeof t&&(e.imosCallBack[r]=t),e.readyState?e.contentWindow.postMessage({func:"imosSdkStop",params:{token:n.token,xpcode:e.xpcode,tag:r}},"*"):e.onload=function(){e.readyState=!0,e.contentWindow.postMessage({func:"imosSdkStop",params:{token:n.token,xpcode:e.xpcode,tag:r}},"*")},{v:void 0}}();if("object"===("undefined"===typeof a?"undefined":r(a)))return a.v}}},{key:"imosSdkStop",value:function(e,t){this.sdkStop(e,t)}},{key:"_cancelRecordTask",value:function(e){e.hasRecordTask&&(e.hasRecordTask=!1,delete this.recordTaskObj[e.id])}},{key:"_imosForceMSLink",value:function(e){this.post2All({func:"forceMSLink",params:{address:e}})}},{key:"_imosVideoDebugStart",value:function(e,t){e=parseInt(e,10),this.post2One({func:"videoDebugStart",params:{size:e}},t)}},{key:"_imosVideoDebugClose",value:function(e){this.post2One({func:"videoDebugClose",params:{}},e)}},{key:"_imosVideoCmd",value:function(e){this.post2One({func:"videoOnWindowCmd",params:{}},e)}},{key:"_post2All",value:function(e){for(var t=0;t<this.iframes.length;t++){var n=this.iframes[t];n.readyState&&n.contentWindow.postMessage(e,"*")}}},{key:"_post2One",value:function(e,t){for(var n=0;n<this.iframes.length;n++)if(this.iframes[n]===t||this.iframes[n].id===t){var i=this.iframes[n];if(i.readyState)return i.contentWindow.postMessage(e,"*"),!0}return!1}},{key:"createPanelWindow",value:function(){if(this.iframes.length>=this.paneNum){for(var e=0;e<this.iframes.length;e++){var t=this.iframes[e];if(null===document.getElementById(t.id))return console.warn("\u7a97\u683c\u6570\u5df2\u8fbe\u4e0a\u9650\uff0c\u4f46\u53d1\u73b0\u53ef\u7528\u7a97\u683c\uff1a"+t.xpcode),t}return console.warn("\u7a97\u683c\u6570\u5df2\u8fbe\u4e0a\u9650\uff0c\u4e14\u65e0\u53ef\u7528\u7a97\u683c"),null}var n={};try{n=document.createElement("<iframe></iframe>")}catch(e){n=document.createElement("iframe")}return n.id=o.a.GUID(),n.src="http://"+this.ip+":7010/static/IMOSPlayer.html?call="+encodeURI("http://"+window.location.host+this.htmlUrl),n.name="playWindow@"+this.iframes.length+1,n.xpcode=this.xpCode+"&0"+(this.xpFirstWndCode+this.iframes.length),n.width="400px",n.height="400px",n.frameborder="0",n.readyState=!1,n.imosCallBack=[],n.hasRecordTask=!1,n.onload=function(){n.readyState=!0},this.iframes.push(n),n}},{key:"onIframeClosed",value:function(e){for(var t=e.target.querySelectorAll("iframe"),n=0;n<t.length;n++){var i=t[n];i.name.indexOf("playWindow@")>-1&&this.sdkStop(i.id)}}}]),e}(),c=new s;window.imosSdk=c,Object.defineProperty&&Object.defineProperty(window,"imosSdk",{configurable:!1,enumerable:!1,writable:!1})},9:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(){i(this,e)}return r(e,null,[{key:"GUID",value:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},{key:"clone",value:function(e){if(null===e)return null;var t=this.isArray(e)?[]:{};for(var n in e)t[n]=e[n]instanceof Date?new Date(e[n].getTime()):"object"===o(e[n])?this.clone(e[n]):e[n];return t}},{key:"eqs",value:function(e,t){return e.toLowerCase()===t.toLowerCase()}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.apply(e)}},{key:"isObject",value:function(e){return null!==e&&"object"===("undefined"===typeof e?"undefined":o(e))}},{key:"isDate",value:function(e){return"[object Date]"===toString.call(e)}},{key:"forEach",value:function(e,t){if(null!==e&&"undefined"!==typeof e)if("object"!==("undefined"===typeof e?"undefined":o(e))&&(e=[e]),this.isArray(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}},{key:"time2String",value:function(e){var t=e.getFullYear(),n=(e.getMonth()+1).toString(),i=e.getDate().toString();1===n.length&&(n="0"+n),1===i.length&&(i="0"+i);var o=e.getHours().toString();1===o.length&&(o="0"+o);var r=e.getMinutes().toString();1===r.length&&(r="0"+r);var a=e.getSeconds().toString();return 1===a.length&&(a="0"+a),t+"-"+n+"-"+i+" "+o+":"+r+":"+a}},{key:"isIe",value:function(){return void 0!==window.ActiveXObject||(navigator.userAgent.indexOf("rv:11")>-1||navigator.userAgent.indexOf("Edge")>-1)}},{key:"isFF",value:function(){return"FF"===e._judgeAllBrowser()}},{key:"isChrome",value:function(){return"Chrome"===e._judgeAllBrowser()}},{key:"isOpera",value:function(){return"Opera"===e._judgeAllBrowser()}},{key:"isSarafi",value:function(){return"Sarafi"===e._judgeAllBrowser()}},{key:"isFF",value:function(){return"FF"===e._judgeAllBrowser()}},{key:"_judgeAllBrowser",value:function(){var e=navigator.userAgent;return e.indexOf("Opera")>-1?"Opera":e.indexOf("Firefox")>-1?"FF":e.indexOf("Chrome")>-1?"Chrome":e.indexOf("Safari")>-1?"Safari":void 0}},{key:"screenSize",value:function(){return{width:window.screen.width,height:window.screen.height}}},{key:"goFullScreenMethod",value:function(){var e=document.documentElement;return e.requestFullScreen||e.webkitRequestFullScreen||e.mozRequestFullScreen||e.msRequestFullScreen||!1}},{key:"exitFullScreenMethod",value:function(){return document.exitFullscreen||document.mozCancelFullScreen||document.webkitCancelFullScreen||document.msExitFullscreen||!1}},{key:"goFullScreen",value:function(t,n){var i=e.goFullScreenMethod();if(!1!==i){var o=document.documentElement;n&&o instanceof HTMLElement&&(o=t),i.call(o)}}},{key:"exitFullScreen",value:function(){var t=e.exitFullScreenMethod();!1!==t&&t.call(document)}},{key:"isFullScreen",value:function(){var t={width:document.body.clientWidth,height:document.body.clientHeight},n={width:e.screenSize().width,height:e.screenSize().height};return n.width===t.width&&n.height===t.height}},{key:"retained6Decimal",value:function(e){var t=e.toString(),n=t.indexOf(".");if(n<0)return t+".000000";if(t.length-n<=6){for(;t.length-n<=6;)t+="0";return t}return t.substr(0,n+7)}},{key:"isHttps",value:function(){return"https:"===window.location.protocol.toLowerCase}}]),e}();t.a=a}});